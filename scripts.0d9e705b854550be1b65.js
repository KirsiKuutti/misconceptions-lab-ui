const C1=[],C2=[],C3=[],script=["Message 1","Message 2","Message 3","Message 4","Message 5","Message 6","Message 7"];let hint_count=2,timestamp=0,message_number_C1=0,message_number_C2=0,message_number_C3=0;const original_cooldown=[],node1selected=!1,node2selected=!1,isRunning=!1,circuits=!1;function Node(e){const t=document.createElement("BUTTON");t.setAttribute("id",e);const n=document.createTextNode(e);t.appendChild(n),document.getElementById("buttonnodes").appendChild(t),t.message="",t.cooldown=0}function cansend(e){return 0===e.cooldown&&""!==e.message}function canreceive(e){return""===e.message}function send(e,t){"PlainText"===level.options[level.selectedIndex].value?(receive(t,e.message),e.message=""):(e.message=genRndString(),t.message=genRndString()),"1"===e.id?e.cooldown=original_cooldown[0]:"2"===e.id?e.cooldown=original_cooldown[1]:"3"===e.id?e.cooldown=original_cooldown[2]:"4"===e.id?e.cooldown=original_cooldown[3]:"5"===e.id?e.cooldown=original_cooldown[4]:"6"===e.id?e.cooldown=original_cooldown[5]:"7"===e.id?e.cooldown=original_cooldown[6]:"8"===e.id?e.cooldown=original_cooldown[7]:"9"===e.id?e.cooldown=original_cooldown[8]:"A"===e.id?e.cooldown=original_cooldown[9]:"B"===e.id?e.cooldown=original_cooldown[10]:"C"===e.id&&(e.cooldown=original_cooldown[11])}function receive(e,t){e.message=t}let one,two,three,four,five,six,seven,eight,nine,A,B,C,X,Y,Z,Node1_timeout;function init(){this.node1selected=!1,this.node2selected=!1,this.circuits=!1,document.getElementById("circuits").disabled=!1,this.isRunning=!1,this.one=new Node("1"),this.two=new Node("2"),this.three=new Node("3"),this.four=new Node("4"),this.five=new Node("5"),this.six=new Node("6"),this.seven=new Node("7"),this.eight=new Node("8"),this.nine=new Node("9"),this.A=new Node("A"),this.B=new Node("B"),this.C=new Node("C"),this.X=new Node("X"),this.Y=new Node("Y"),this.Z=new Node("Z"),level=document.getElementById("Diff"),list1=document.getElementById("Node1"),prev_state_N1=list1.options[list1.selectedIndex].value,list2=document.getElementById("Node2"),prev_state_N2=list2.options[list2.selectedIndex].value,document.getElementById("X").cooldown=getRndInteger(5,1),document.getElementById("Y").cooldown=getRndInteger(5,1),document.getElementById("Z").cooldown=getRndInteger(5,1)}var list1,prev_state_N1;let curr_state_N1,Node2_timeout;function Log_Node1(e){nodecheck1(e),(curr_state_N1=list1.options[list1.selectedIndex].value)!==prev_state_N1&&(document.getElementById("TA1").innerHTML="",clearTimeout(Node1_timeout),prev_state_N1=curr_state_N1),""===document.getElementById(curr_state_N1).message?document.getElementById("TA1").innerHTML+="...\n":document.getElementById("TA1").innerHTML+=document.getElementById(curr_state_N1).message+"\n",Node1_timeout=setTimeout(Log_Node1,2e3)}var list2,prev_state_N2;let curr_state_N2,simulation_timer;function Log_Node2(e){nodecheck2(e),(curr_state_N2=list2.options[list2.selectedIndex].value)!==prev_state_N2&&(document.getElementById("TA2").innerHTML="",clearTimeout(Node2_timeout),prev_state_N2=curr_state_N2),""===document.getElementById(curr_state_N2).message?document.getElementById("TA2").innerHTML+="...\n":document.getElementById("TA2").innerHTML+=document.getElementById(curr_state_N2).message+"\n",Node2_timeout=setTimeout(Log_Node2,2e3)}function getRndInteger(e,t){return Math.floor(Math.random()*(e-t+1))+t}function genRndString(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return e[getRndInteger(25,0)]+"0123456789"[getRndInteger(9,0)]+"!@#$%^&*()_+="[getRndInteger(12,0)]+e[getRndInteger(25,0)]+"!@#$%^&*()_+="[getRndInteger(12,0)]}function generate_circuits(){this.circuits=!0,document.getElementById("circuits").disabled=!0,C1[0]="A",C1[1]=String(getRndInteger(3,1)),C1[2]=String(getRndInteger(6,4)),C1[3]=String(getRndInteger(9,7));const e=String(getRndInteger(3,1));let t;for(C1[4]=1===e?"X":2===e?"Y":"Z",C2[0]="B";;)if(t=String(getRndInteger(3,1)),!C1.includes(t)){C2[1]=t;break}for(;;)if(t=String(getRndInteger(6,4)),!C1.includes(t)){C2[2]=t;break}for(;;)if(t=String(getRndInteger(9,7)),!C1.includes(t)){C2[3]=t;break}for(;;)if(t=String(getRndInteger(3,1)),!C1.includes(t="1"===t?"X":"2"===t?"Y":"Z")){C2[4]=t;break}for(C3[0]="C";;)if(t=String(getRndInteger(3,1)),!C1.includes(t)&&!C2.includes(t)){C3[1]=t;break}for(;;)if(t=String(getRndInteger(6,4)),!C1.includes(t)&&!C2.includes(t)){C3[2]=t;break}for(;;)if(t=String(getRndInteger(9,7)),!C1.includes(t)&&!C2.includes(t)){C3[3]=t;break}for(;;)if(t=String(getRndInteger(3,1)),!C1.includes(t="1"===t?"X":"2"===t?"Y":"Z")&&!C2.includes(t)){C3[4]=t;break}for(let n=0;n<12;n++)original_cooldown[n]=getRndInteger(5,1);alert("TOR Circuits Setup! Good Luck!")}var level;function start_sim(){let e;if(this.isRunning=!0,document.getElementById("stop").disabled=!1,document.getElementById("start").disabled=!0,void 0===level&&alert("ERROR"),"PlainText"===level.options[level.selectedIndex].value)if(0===timestamp)document.getElementById(C1[0]).message=script[message_number_C1],document.getElementById(C2[0]).message=script[message_number_C2],document.getElementById(C3[0]).message=script[message_number_C3];else{for(timestamp%document.getElementById(C1[4]).cooldown==0&&(document.getElementById(C1[4]).message=""),timestamp%document.getElementById(C2[4]).cooldown==0&&(document.getElementById(C2[4]).message=""),timestamp%document.getElementById(C3[4]).cooldown==0&&(document.getElementById(C3[4]).message=""),e=3;e>=0;e--)0!==document.getElementById(C1[e]).cooldown&&document.getElementById(C1[e]).cooldown--,0!==document.getElementById(C2[e]).cooldown&&document.getElementById(C2[e]).cooldown--,0!==document.getElementById(C3[e]).cooldown&&document.getElementById(C3[e]).cooldown--;for(e=4;e>0;e--)cansend(document.getElementById(C1[e-1]))&&canreceive(document.getElementById(C1[e]))&&(send(document.getElementById(C1[e-1]),document.getElementById(C1[e])),e-1==0&&(message_number_C1++,document.getElementById(C1[e-1]).message=script[message_number_C1%7])),cansend(document.getElementById(C2[e-1]))&&canreceive(document.getElementById(C2[e]))&&(send(document.getElementById(C2[e-1]),document.getElementById(C2[e])),e-1==0&&(message_number_C2++,document.getElementById(C2[e-1]).message=script[message_number_C2%7])),cansend(document.getElementById(C3[e-1]))&&canreceive(document.getElementById(C3[e]))&&(send(document.getElementById(C3[e-1]),document.getElementById(C3[e])),e-1==0&&(message_number_C3++,document.getElementById(C3[e-1]).message=script[message_number_C3%7]))}else if(0===timestamp)document.getElementById(C1[0]).message=genRndString(),document.getElementById(C2[0]).message=genRndString(),document.getElementById(C3[0]).message=genRndString();else{for(timestamp%document.getElementById(C1[4]).cooldown==0&&(document.getElementById(C1[4]).message=""),timestamp%document.getElementById(C2[4]).cooldown==0&&(document.getElementById(C2[4]).message=""),timestamp%document.getElementById(C3[4]).cooldown==0&&(document.getElementById(C3[4]).message=""),e=3;e>=0;e--)0!==document.getElementById(C1[e]).cooldown&&document.getElementById(C1[e]).cooldown--,0!==document.getElementById(C2[e]).cooldown&&document.getElementById(C2[e]).cooldown--,0!==document.getElementById(C3[e]).cooldown&&document.getElementById(C3[e]).cooldown--;for(e=4;e>0;e--)cansend(document.getElementById(C1[e-1]))&&canreceive(document.getElementById(C1[e]))&&(send(document.getElementById(C1[e-1]),document.getElementById(C1[e])),e-1==0&&(message_number_C1++,document.getElementById(C1[e-1]).message=genRndString())),cansend(document.getElementById(C2[e-1]))&&canreceive(document.getElementById(C2[e]))&&(send(document.getElementById(C2[e-1]),document.getElementById(C2[e])),e-1==0&&(message_number_C2++,document.getElementById(C2[e-1]).message=genRndString())),cansend(document.getElementById(C3[e-1]))&&canreceive(document.getElementById(C3[e]))&&(send(document.getElementById(C3[e-1]),document.getElementById(C3[e])),e-1==0&&(message_number_C3++,document.getElementById(C3[e-1]).message=genRndString()))}timestamp++,simulation_timer=setTimeout(start_sim,2e3)}function stop_sim(){this.isRunning=!1,document.getElementById("start").disabled=!1,document.getElementById("stop").disabled=!0,clearTimeout(simulation_timer),clearTimeout(Node1_timeout),clearTimeout(Node2_timeout)}function show_hints(){hint_count>0?(alert("You have "+hint_count+" hints remaining!"),alert("Node "+C1[hint_count]+" lies on the circuit starting from client A!"),hint_count--):alert("You've run out of hints! Come on chum, you can do it!")}function test(){console.log(C1),console.log(C2),console.log(C3)}function nodecheck1(e){this.node1selected=!0,!0===this.node2selected&&!1===isRunning&&this.circuits&&(document.getElementById("start").disabled=!1)}function nodecheck2(e){this.node2selected=!0,!0===this.node1selected&&!1===isRunning&&this.circuits&&(document.getElementById("start").disabled=!1)}